# LiteLLM é”™è¯¯æ—¥å¿—åˆ†æå·¥å…· - æ“ä½œæ–‡æ¡£

## ğŸ“‹ å·¥å…·ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªç”¨äºæŸ¥è¯¢å’Œåˆ†æ LiteLLM é”™è¯¯æ—¥å¿—çš„ Python å·¥å…·ã€‚å®ƒå¯ä»¥ä» LiteLLM çš„ PostgreSQL æ•°æ®åº“ä¸­æŸ¥è¯¢é”™è¯¯æ—¥å¿—ï¼Œå¹¶æ”¯æŒä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å¯¹é”™è¯¯è¿›è¡Œæ™ºèƒ½åˆ†æã€‚

### ä¸»è¦åŠŸèƒ½

1. **é”™è¯¯æ—¥å¿—æŸ¥è¯¢**ï¼šæ”¯æŒä¸‰ä¸ªç­›é€‰æ¡ä»¶
   - æ—¶é—´èŒƒå›´ç­›é€‰
   - æ¨¡å‹åç§°ç­›é€‰
   - API Key Alias ç­›é€‰

2. **æ™ºèƒ½åˆ†æ**ï¼šå¯é€‰çš„å¤§è¯­è¨€æ¨¡å‹åˆ†æ
   - é”™è¯¯ç±»å‹ç»Ÿè®¡
   - é—®é¢˜æ ¹å› åˆ†æ
   - æ”¹è¿›å»ºè®®

3. **ç»“æœä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜æŸ¥è¯¢ç»“æœå’Œåˆ†ææŠ¥å‘Š
   - å®Œæ•´é”™è¯¯æ—¥å¿—ï¼ˆJSON æ ¼å¼ï¼‰
   - ç®€åŒ–åˆ†ææ—¥å¿—ï¼ˆJSON æ ¼å¼ï¼‰
   - LLM åˆ†ææŠ¥å‘Šï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- Dockerï¼ˆç”¨äºè®¿é—® LiteLLM æ•°æ®åº“ï¼‰
- å·²å®‰è£…çš„ä¾èµ–åŒ…ï¼ˆè§ `requirements.txt`ï¼‰

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¾èµ–åŒ…ï¼š
- `psycopg2-binary>=2.9.0` - PostgreSQL æ•°æ®åº“è¿æ¥
- `requests>=2.28.0` - HTTP è¯·æ±‚ï¼ˆç”¨äº LLM API è°ƒç”¨ï¼‰

### 3. é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š

#### 3.1 æ•°æ®åº“é…ç½®

```python
POSTGRES_CONFIG = {
    'container_name': 'litellm-db-bak',  # Docker å®¹å™¨åç§°
    'database': 'litellm_db',            # æ•°æ®åº“åç§°
    'user': 'litellm_user',              # ç”¨æˆ·å
    'password': 'zhipu2025ddh'           # å¯†ç 
}
```

**è¯´æ˜**ï¼š
- å·¥å…·é€šè¿‡ `docker exec` æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œæ— éœ€ç«¯å£æ˜ å°„
- ç¡®ä¿ Docker å®¹å™¨æ­£åœ¨è¿è¡Œï¼š`docker ps | grep litellm-db-bak`

#### 3.2 æŸ¥è¯¢é…ç½®

```python
QUERY_CONFIG = {
    'start_time': None,         # å¼€å§‹æ—¶é—´ï¼Œä¾‹å¦‚: "2025-12-01 00:00:00"
    'end_time': None,           # ç»“æŸæ—¶é—´ï¼Œä¾‹å¦‚: "2025-12-23 23:59:59"
    'key_name': None,           # Key Alias ç­›é€‰ï¼Œä¾‹å¦‚: "agent"ï¼ˆæ³¨æ„ï¼šå¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼ï¼‰
    'model': None,              # Model ç­›é€‰ï¼Œä¾‹å¦‚: "external-qwen3-30b"
    'limit': 100,               # é™åˆ¶è¿”å›æ¡æ•°
    'use_time_filter': True,    # æ˜¯å¦ä½¿ç”¨æ—¶é—´èŒƒå›´ç­›é€‰
    'days_back': 1              # é»˜è®¤æŸ¥è¯¢æœ€è¿‘1å¤©ï¼ˆä»…åœ¨ use_time_filter=True æ—¶ç”Ÿæ•ˆï¼‰
}
```

**é…ç½®è¯´æ˜**ï¼š
- **æ—¶é—´èŒƒå›´**ï¼šå¦‚æœ `start_time` å’Œ `end_time` éƒ½ä¸º `None`ï¼Œä¸” `use_time_filter=True`ï¼Œåˆ™ä½¿ç”¨ `days_back` æŸ¥è¯¢æœ€è¿‘ N å¤©
- **Key Alias**ï¼šå¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼Œä¾‹å¦‚ `'agent'` è€Œä¸æ˜¯ `agent`
- **å…³é—­æ—¶é—´ç­›é€‰**ï¼šè®¾ç½® `use_time_filter=False` å¯ä»¥åªæŒ‰æ¨¡å‹æˆ– Key Alias ç­›é€‰

#### 3.3 LLM é…ç½®

```python
LLM_CONFIG = {
    'enabled': True,            # æ˜¯å¦å¯ç”¨å¤§æ¨¡å‹åˆ†æ
    'api_url': 'http://10.163.25.156:5024/v1/chat/completions',  # LiteLLM Proxy API
    'api_key': 'zhipu2025ddh',  # LITELLM_MASTER_KEY
    'model': 'external-qwen3-30b',  # æ¨¡å‹åç§°
    'timeout': 300              # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
}
```

**è¯´æ˜**ï¼š
- æ”¯æŒ LiteLLM Proxyï¼ˆOpenAI å…¼å®¹æ ¼å¼ï¼‰
- å¦‚æœä¸éœ€è¦ LLM åˆ†æï¼Œè®¾ç½® `enabled: False`

#### 3.4 è¾“å‡ºé…ç½®

```python
OUTPUT_CONFIG = {
    'output_dir': './output',     # è¾“å‡ºç›®å½•
    'save_full_logs': True,       # æ˜¯å¦ä¿å­˜å®Œæ•´é”™è¯¯æ—¥å¿—
    'save_analysis_logs': True,   # æ˜¯å¦ä¿å­˜ç®€åŒ–åçš„åˆ†ææ—¥å¿—
    'save_llm_result': True       # æ˜¯å¦ä¿å­˜ LLM åˆ†æç»“æœ
}
```

---

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
python run_analyzer.py
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæŸ¥è¯¢æœ€è¿‘ 1 å¤©çš„é”™è¯¯æ—¥å¿—

```python
# config.py
QUERY_CONFIG = {
    'start_time': None,
    'end_time': None,
    'key_name': None,
    'model': None,
    'limit': 100,
    'use_time_filter': True,
    'days_back': 1
}
```

#### ç¤ºä¾‹ 2ï¼šæŸ¥è¯¢ç‰¹å®šæ—¶é—´èŒƒå›´ã€æ¨¡å‹å’Œ Key Alias

```python
# config.py
QUERY_CONFIG = {
    'start_time': '2025-12-01 00:00:00',
    'end_time': '2025-12-23 23:59:59',
    'key_name': 'agent',  # âš ï¸ æ³¨æ„ï¼šå¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼
    'model': 'external-qwen3-30b',
    'limit': 100,
    'use_time_filter': True,
    'days_back': 1
}
```

#### ç¤ºä¾‹ 3ï¼šåªç­›é€‰æ¨¡å‹ï¼Œä¸ä½¿ç”¨æ—¶é—´èŒƒå›´

```python
# config.py
QUERY_CONFIG = {
    'start_time': None,
    'end_time': None,
    'key_name': None,
    'model': 'external-qwen3-30b',
    'limit': 100,
    'use_time_filter': False,  # å…³é—­æ—¶é—´ç­›é€‰
    'days_back': 1
}
```

#### ç¤ºä¾‹ 4ï¼šåªç­›é€‰ Key Aliasï¼Œä¸ä½¿ç”¨æ—¶é—´èŒƒå›´

```python
# config.py
QUERY_CONFIG = {
    'start_time': None,
    'end_time': None,
    'key_name': 'agent',  # âš ï¸ æ³¨æ„ï¼šå¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼
    'model': None,
    'limit': 100,
    'use_time_filter': False,  # å…³é—­æ—¶é—´ç­›é€‰
    'days_back': 1
}
```

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶è¯´æ˜

è¿è¡Œåï¼Œç»“æœä¼šä¿å­˜åœ¨ `output/YYYY-MM-DD/` ç›®å½•ä¸‹ï¼ˆæŒ‰æ—¥æœŸåˆ›å»ºå­ç›®å½•ï¼‰ã€‚

### è¾“å‡ºæ–‡ä»¶ç±»å‹

1. **error_logs_full_æ—¶é—´æˆ³.json**
   - å®Œæ•´çš„é”™è¯¯æ—¥å¿—æ•°æ®
   - åŒ…å«æ‰€æœ‰å­—æ®µä¿¡æ¯
   - ç”¨äºè¯¦ç»†åˆ†æ

2. **error_logs_analysis_æ—¶é—´æˆ³.json**
   - ç®€åŒ–åçš„åˆ†ææ—¥å¿—
   - åªåŒ…å«å…³é”®å­—æ®µï¼šrequest_idã€timeã€modelã€key_nameã€statusã€error_typeã€error_message
   - ç”¨äºå¿«é€ŸæŸ¥çœ‹

3. **llm_analysis_æ—¶é—´æˆ³.txt**
   - LLM åˆ†ææŠ¥å‘Šï¼ˆå¦‚æœå¯ç”¨äº† LLM åˆ†æï¼‰
   - åŒ…å«é”™è¯¯ç»Ÿè®¡ã€é—®é¢˜åˆ†æã€æ”¹è¿›å»ºè®®

4. **query_params_æ—¶é—´æˆ³.json**
   - æŸ¥è¯¢å‚æ•°è®°å½•
   - è®°å½•æœ¬æ¬¡æŸ¥è¯¢çš„é…ç½®å’Œç»“æœç»Ÿè®¡

### è¾“å‡ºç›®å½•ç»“æ„

```
output/
â””â”€â”€ 2025-12-25/
    â”œâ”€â”€ error_logs_full_101530.json
    â”œâ”€â”€ error_logs_analysis_101530.json
    â”œâ”€â”€ llm_analysis_101530.txt
    â””â”€â”€ query_params_101530.json
```

---

## ğŸ” ç­›é€‰æ¡ä»¶è¯¦è§£

### 1. æ—¶é—´èŒƒå›´ç­›é€‰

**ä½¿ç”¨åœºæ™¯**ï¼šæŸ¥è¯¢ç‰¹å®šæ—¶é—´æ®µçš„é”™è¯¯æ—¥å¿—

**é…ç½®æ–¹å¼**ï¼š
```python
'start_time': '2025-12-01 00:00:00',
'end_time': '2025-12-23 23:59:59',
'use_time_filter': True
```

**æˆ–è€…ä½¿ç”¨ç›¸å¯¹æ—¶é—´**ï¼š
```python
'start_time': None,
'end_time': None,
'use_time_filter': True,
'days_back': 7  # æŸ¥è¯¢æœ€è¿‘ 7 å¤©
```

### 2. æ¨¡å‹åç§°ç­›é€‰

**ä½¿ç”¨åœºæ™¯**ï¼šåªæŸ¥è¯¢ç‰¹å®šæ¨¡å‹çš„é”™è¯¯æ—¥å¿—

**é…ç½®æ–¹å¼**ï¼š
```python
'model': 'external-qwen3-30b'
```

**è¯´æ˜**ï¼š
- æ¨¡å‹åç§°å¿…é¡»ä¸ LiteLLM ä¸­é…ç½®çš„æ¨¡å‹åç§°å®Œå…¨åŒ¹é…
- å¯ä»¥åœ¨ LiteLLM çš„ `config.yaml` ä¸­æŸ¥çœ‹æ¨¡å‹åç§°

### 3. Key Alias ç­›é€‰

**ä½¿ç”¨åœºæ™¯**ï¼šåªæŸ¥è¯¢ç‰¹å®š API Key çš„é”™è¯¯æ—¥å¿—

**é…ç½®æ–¹å¼**ï¼š
```python
'key_name': 'agent'  # âš ï¸ æ³¨æ„ï¼šå¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼
```

**é‡è¦æç¤º**ï¼š
- **å¿…é¡»ç”¨å¼•å·åŒ…è£¹**ï¼Œå¦åˆ™ä¼šæŠ¥é”™ `name 'xxx' is not defined`
- Key Alias æ˜¯ LiteLLM ä¸­é…ç½®çš„ API Key åˆ«å
- å¯ä»¥åœ¨ LiteLLM ç®¡ç†ç•Œé¢æŸ¥çœ‹ Key Alias

### 4. ç»„åˆç­›é€‰

å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªç­›é€‰æ¡ä»¶ï¼š

```python
QUERY_CONFIG = {
    'start_time': '2025-12-01 00:00:00',
    'end_time': '2025-12-23 23:59:59',
    'key_name': 'agent',
    'model': 'external-qwen3-30b',
    'limit': 100,
    'use_time_filter': True
}
```

---

## ğŸ› ï¸ æŠ€æœ¯è¯´æ˜

### æ•°æ®åº“æŸ¥è¯¢æ–¹å¼

å·¥å…·ä½¿ç”¨ `docker exec` æ–¹å¼è®¿é—® PostgreSQL æ•°æ®åº“ï¼Œæ— éœ€ç«¯å£æ˜ å°„ï¼š

```python
docker exec -e PGPASSWORD=å¯†ç  å®¹å™¨å psql -U ç”¨æˆ·å -d æ•°æ®åº“å
```

**ä¼˜åŠ¿**ï¼š
- æ— éœ€æš´éœ²æ•°æ®åº“ç«¯å£
- æ›´å®‰å…¨
- é€‚ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²

### æ•°æ®è¡¨è¯´æ˜

#### LiteLLM_SpendLogs è¡¨ï¼ˆä¸»è¦ä½¿ç”¨ï¼‰

- **æ—¶é—´å­—æ®µ**ï¼š`startTime`
- **æ¨¡å‹å­—æ®µ**ï¼š`model`
- **Key å­—æ®µ**ï¼š`metadata->>'user_api_key_alias'`ï¼ˆå­˜å‚¨åœ¨ JSON ä¸­ï¼‰
- **çŠ¶æ€å­—æ®µ**ï¼š`status`ï¼ˆ'success' è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–ä¸ºé”™è¯¯ï¼‰

**SQL æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```sql
SELECT * FROM "LiteLLM_SpendLogs" 
WHERE 
    "startTime" >= '2025-12-01 00:00:00'::timestamp
    AND "model" = 'external-qwen3-30b'
    AND metadata->>'user_api_key_alias' = 'agent'
    AND "status" != 'success'
```

#### LiteLLM_ErrorLogs è¡¨ï¼ˆè¾…åŠ©ä½¿ç”¨ï¼‰

- **æ—¶é—´å­—æ®µ**ï¼š`startTime`
- **æ¨¡å‹å­—æ®µ**ï¼š`litellm_model_name`
- **âš ï¸ æ³¨æ„**ï¼šæ­¤è¡¨æ²¡æœ‰ Key ç›¸å…³å­—æ®µï¼Œæ— æ³•é€šè¿‡ Key Alias ç­›é€‰

### å·¥ä½œæµç¨‹

1. **åŠ è½½é…ç½®**ï¼šä» `config.py` è¯»å–é…ç½®
2. **è§£æå‚æ•°**ï¼šå¤„ç†æ—¶é—´èŒƒå›´ã€æ¨¡å‹ã€Key Alias ç­‰ç­›é€‰æ¡ä»¶
3. **æŸ¥è¯¢æ•°æ®åº“**ï¼šé€šè¿‡ `docker exec` æ‰§è¡Œ SQL æŸ¥è¯¢
4. **æ•°æ®å¤„ç†**ï¼šæå–å…³é”®ä¿¡æ¯ï¼Œå‡†å¤‡åˆ†ææ•°æ®
5. **LLM åˆ†æ**ï¼ˆå¯é€‰ï¼‰ï¼šè°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ API è¿›è¡Œåˆ†æ
6. **ä¿å­˜ç»“æœ**ï¼šå°†ç»“æœä¿å­˜åˆ° `output/æ—¥æœŸ/` ç›®å½•

---

## â“ å¸¸è§é—®é¢˜

### Q1: æŠ¥é”™ `name 'agent' is not defined`

**åŸå› **ï¼šåœ¨ `config.py` ä¸­è®¾ç½® `key_name` æ—¶æ²¡æœ‰ç”¨å¼•å·åŒ…è£¹

**è§£å†³æ–¹æ³•**ï¼š
```python
# âŒ é”™è¯¯
'key_name': agent

# âœ… æ­£ç¡®
'key_name': 'agent'
```

### Q2: æŠ¥é”™ `No such container: litellm-db-bak`

**åŸå› **ï¼šDocker å®¹å™¨åç§°ä¸æ­£ç¡®æˆ–å®¹å™¨æœªè¿è¡Œ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥å®¹å™¨åç§°ï¼š`docker ps`
2. ä¿®æ”¹ `config.py` ä¸­çš„ `container_name`
3. ç¡®ä¿å®¹å™¨æ­£åœ¨è¿è¡Œ

### Q3: æŸ¥è¯¢ä¸åˆ°æ•°æ®

**å¯èƒ½åŸå› **ï¼š
1. æ—¶é—´èŒƒå›´è®¾ç½®é”™è¯¯
2. æ¨¡å‹åç§°ä¸åŒ¹é…
3. Key Alias ä¸å­˜åœ¨
4. è¯¥æ—¶é—´æ®µå†…ç¡®å®æ²¡æœ‰é”™è¯¯æ—¥å¿—

**è§£å†³æ–¹æ³•**ï¼š
1. å…ˆä¸ä½¿ç”¨ç­›é€‰æ¡ä»¶ï¼ŒæŸ¥è¯¢æ‰€æœ‰é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥æ•°æ®åº“ä¸­çš„å®é™…æ•°æ®
3. ç¡®è®¤æ¨¡å‹åç§°å’Œ Key Alias æ˜¯å¦æ­£ç¡®

### Q4: LLM åˆ†æå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. LLM API åœ°å€ä¸æ­£ç¡®
2. API Key é”™è¯¯
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. æ¨¡å‹åç§°ä¸åŒ¹é…

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `LLM_CONFIG` ä¸­çš„é…ç½®
2. æµ‹è¯• API è¿æ¥ï¼š`curl -X POST http://...`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q5: è¾“å‡ºç›®å½•ä¸å­˜åœ¨

**è§£å†³æ–¹æ³•**ï¼š
- å·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•
- å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™

---

## ğŸ“Š ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1ï¼šæ—¥å¸¸é”™è¯¯ç›‘æ§

**éœ€æ±‚**ï¼šæ¯å¤©æŸ¥çœ‹æœ€è¿‘ 1 å¤©çš„é”™è¯¯æ—¥å¿—

**é…ç½®**ï¼š
```python
QUERY_CONFIG = {
    'start_time': None,
    'end_time': None,
    'use_time_filter': True,
    'days_back': 1,
    'limit': 100
}
LLM_CONFIG = {
    'enabled': True  # å¯ç”¨ LLM åˆ†æ
}
```

**æ‰§è¡Œ**ï¼š
```bash
python run_analyzer.py
```

### åœºæ™¯ 2ï¼šç‰¹å®šæ¨¡å‹é—®é¢˜æ’æŸ¥

**éœ€æ±‚**ï¼šæ’æŸ¥æŸä¸ªæ¨¡å‹çš„é”™è¯¯é—®é¢˜

**é…ç½®**ï¼š
```python
QUERY_CONFIG = {
    'start_time': '2025-12-20 00:00:00',
    'end_time': '2025-12-25 23:59:59',
    'model': 'external-qwen3-30b',
    'use_time_filter': True,
    'limit': 200
}
```

### åœºæ™¯ 3ï¼šç‰¹å®š Key çš„é”™è¯¯åˆ†æ

**éœ€æ±‚**ï¼šåˆ†ææŸä¸ª API Key çš„é”™è¯¯æƒ…å†µ

**é…ç½®**ï¼š
```python
QUERY_CONFIG = {
    'start_time': None,
    'end_time': None,
    'key_name': 'agent',
    'use_time_filter': False,  # ä¸é™åˆ¶æ—¶é—´
    'limit': 100
}
```

### åœºæ™¯ 4ï¼šé—®é¢˜æ ¹å› åˆ†æ

**éœ€æ±‚**ï¼šæ·±å…¥åˆ†æé”™è¯¯åŸå› ï¼Œè·å–æ”¹è¿›å»ºè®®

**é…ç½®**ï¼š
```python
QUERY_CONFIG = {
    'start_time': '2025-12-20 00:00:00',
    'end_time': '2025-12-25 23:59:59',
    'limit': 50  # é™åˆ¶æ•°é‡ï¼Œä¾¿äº LLM åˆ†æ
}
LLM_CONFIG = {
    'enabled': True,
    'timeout': 600  # å¢åŠ è¶…æ—¶æ—¶é—´
}
```

---

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è¾“å‡ºç›®å½•

```python
OUTPUT_CONFIG = {
    'output_dir': '/data/litellm/error_analysis',  # ç»å¯¹è·¯å¾„
    'save_full_logs': True,
    'save_analysis_logs': True,
    'save_llm_result': True
}
```

### è°ƒæ•´æŸ¥è¯¢é™åˆ¶

```python
QUERY_CONFIG = {
    'limit': 500  # å¢åŠ æŸ¥è¯¢æ¡æ•°ï¼ˆæ³¨æ„ï¼šLLM åˆ†æå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰
}
```

### ç¦ç”¨ LLM åˆ†æï¼ˆä»…æŸ¥è¯¢ï¼‰

```python
LLM_CONFIG = {
    'enabled': False  # åªæŸ¥è¯¢ï¼Œä¸åˆ†æ
}
```

---

## â° å®šæ—¶ä»»åŠ¡é…ç½®

### Linux Cron å®šæ—¶ä»»åŠ¡

å¦‚æœéœ€è¦æ¯å¤©è‡ªåŠ¨è¿è¡Œé”™è¯¯æ—¥å¿—åˆ†æï¼Œå¯ä»¥ä½¿ç”¨ Linux çš„ `crontab` å®šæ—¶ä»»åŠ¡ã€‚

#### 1. ç¼–è¾‘ crontab

```bash
crontab -e
```

#### 2. æ·»åŠ å®šæ—¶ä»»åŠ¡

**æ¯å¤© 19:10 æ‰§è¡Œ**ï¼š
```bash
10 19 * * * cd /path/to/litellm_error_analyzer && /usr/bin/python3 run_analyzer.py >> /var/log/litellm_analyzer.log 2>&1
```

**Cron è¡¨è¾¾å¼æ ¼å¼**ï¼š
```
åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ
```

**å¸¸ç”¨æ—¶é—´ç¤ºä¾‹**ï¼š

| è¯´æ˜ | Cron è¡¨è¾¾å¼ | ç¤ºä¾‹ |
|------|------------|------|
| æ¯å¤© 19:10 | `10 19 * * *` | æ¯å¤© 19:10 æ‰§è¡Œ |
| æ¯å¤© 00:00 | `0 0 * * *` | æ¯å¤©åˆå¤œæ‰§è¡Œ |
| æ¯å¤© 09:30 | `30 9 * * *` | æ¯å¤©ä¸Šåˆ 9:30 æ‰§è¡Œ |
| æ¯å°æ—¶ | `0 * * * *` | æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ |
| æ¯ 30 åˆ†é’Ÿ | `*/30 * * * *` | æ¯ 30 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ |
| æ¯å‘¨ä¸€ 10:00 | `0 10 * * 1` | æ¯å‘¨ä¸€ 10:00 æ‰§è¡Œ |
| æ¯æœˆ 1 å· 08:00 | `0 8 1 * *` | æ¯æœˆ 1 å· 8:00 æ‰§è¡Œ |

**å­—æ®µè¯´æ˜**ï¼š
- **åˆ†**ï¼š0-59
- **æ—¶**ï¼š0-23
- **æ—¥**ï¼š1-31
- **æœˆ**ï¼š1-12 æˆ– JAN-DEC
- **æ˜ŸæœŸ**ï¼š0-7ï¼ˆ0 å’Œ 7 éƒ½è¡¨ç¤ºå‘¨æ—¥ï¼‰æˆ– SUN-SAT

#### 3. å®Œæ•´å®šæ—¶ä»»åŠ¡ç¤ºä¾‹

```bash
# æ¯å¤© 19:10 æ‰§è¡Œé”™è¯¯æ—¥å¿—åˆ†æ
10 19 * * * cd /home/user/litellm_error_analyzer && /usr/bin/python3 run_analyzer.py >> /var/log/litellm_analyzer.log 2>&1

# æ¯å¤© 00:00 æ‰§è¡Œï¼ˆæŸ¥è¯¢å‰ä¸€å¤©çš„é”™è¯¯ï¼‰
0 0 * * * cd /home/user/litellm_error_analyzer && /usr/bin/python3 run_analyzer.py >> /var/log/litellm_analyzer.log 2>&1
```

**æ³¨æ„äº‹é¡¹**ï¼š
1. ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼šç¡®ä¿ `cd` å’Œ Python è·¯å¾„éƒ½æ˜¯ç»å¯¹è·¯å¾„
2. æ—¥å¿—è¾“å‡ºï¼š`>>` è¡¨ç¤ºè¿½åŠ æ—¥å¿—ï¼Œ`2>&1` è¡¨ç¤ºå°†é”™è¯¯è¾“å‡ºä¹Ÿé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶
3. ç¯å¢ƒå˜é‡ï¼šå¦‚æœ Python è„šæœ¬ä¾èµ–ç‰¹å®šç¯å¢ƒå˜é‡ï¼Œéœ€è¦åœ¨ crontab ä¸­è®¾ç½®ï¼š
   ```bash
   10 19 * * * export PATH=/usr/local/bin:$PATH && cd /path/to/litellm_error_analyzer && /usr/bin/python3 run_analyzer.py
   ```

#### 4. æŸ¥çœ‹å®šæ—¶ä»»åŠ¡

```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡
crontab -l

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼ˆUbuntu/Debianï¼‰
grep CRON /var/log/syslog

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼ˆCentOS/RHELï¼‰
grep CRON /var/log/cron
```

### Windows å®šæ—¶ä»»åŠ¡

#### ä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åº

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"ï¼ˆTask Schedulerï¼‰
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è®¾ç½®è§¦å‘å™¨ï¼šæ¯å¤© 19:10
4. è®¾ç½®æ“ä½œï¼šå¯åŠ¨ç¨‹åº
   - ç¨‹åºï¼š`python.exe` çš„å®Œæ•´è·¯å¾„
   - å‚æ•°ï¼š`run_analyzer.py`
   - èµ·å§‹äºï¼š`C:\Users\10279\Desktop\litellm\litellm_error_analyzer`

#### ä½¿ç”¨ PowerShell åˆ›å»ºå®šæ—¶ä»»åŠ¡

```powershell
$action = New-ScheduledTaskAction -Execute "python.exe" -Argument "run_analyzer.py" -WorkingDirectory "C:\Users\10279\Desktop\litellm\litellm_error_analyzer"
$trigger = New-ScheduledTaskTrigger -Daily -At "19:10"
Register-ScheduledTask -TaskName "LiteLLMé”™è¯¯æ—¥å¿—åˆ†æ" -Action $action -Trigger $trigger
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Key Alias å¿…é¡»ç”¨å¼•å·åŒ…è£¹**ï¼š`'agent'` è€Œä¸æ˜¯ `agent`
2. **æ—¶é—´æ ¼å¼**ï¼šä½¿ç”¨ `"YYYY-MM-DD HH:MM:SS"` æ ¼å¼
3. **å®¹å™¨åç§°**ï¼šç¡®ä¿ Docker å®¹å™¨åç§°æ­£ç¡®
4. **LLM åˆ†æ**ï¼šå¤§é‡æ—¥å¿—å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®è®¾ç½®åˆç†çš„ `limit`
5. **è¾“å‡ºç›®å½•**ï¼šå·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºæŒ‰æ—¥æœŸå‘½åçš„å­ç›®å½•

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥é…ç½®æ–‡ä»¶ `config.py` æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ Docker å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
4. æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼š`docker exec -e PGPASSWORD=å¯†ç  å®¹å™¨å psql -U ç”¨æˆ·å -d æ•°æ®åº“å`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `SQLæŸ¥è¯¢å‘½ä»¤.md` - ç›´æ¥ä½¿ç”¨ SQL æŸ¥è¯¢çš„å‚è€ƒæ–‡æ¡£
- `requirements.txt` - Python ä¾èµ–åˆ—è¡¨

---

**ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025-12-25


