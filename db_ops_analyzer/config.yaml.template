# 数据库运维分析工具配置文件

# 服务器配置
server:
  host: "0.0.0.0"
  port: 8000

# 任务配置
tasks:
  # MySQL性能分析任务
  - name: "MySQL_Performance_Analysis"
    source:
      name: "mysql"
      params:
        host: "localhost"
        port: 3306
        user: "root"
        password: "your_password"
        database: "your_database"  # 可选，不指定则分析所有数据库（建议指定，减少影响）
        collect_slow_queries: true
        collect_processlist: true
        collect_status: true
        collect_variables: true
        collect_indexes: true
        collect_tables: true
        slow_query_limit: 100
        
        # 性能优化配置（降低对数据库的影响）
        query_timeout: 30        # 查询超时时间（秒），防止长时间占用
        read_only_mode: true     # 只读模式（强烈推荐开启，确保不会修改数据）
        low_priority: true       # 低优先级查询（MySQL 8.0+，让业务查询优先）
        table_limit: 1000        # 表信息收集限制（避免查询大量表）
        index_limit: 5000        # 索引信息收集限制（避免查询大量索引）
    
    analyzer:
      name: "langgraph"
      params:
        base_url: "http://your-llm-server/v1"
        api_key: "your-api-key"
        model_name: "your-model-name"
        timeout: 60
        prompts:
          analyze_database: |
            # 数据库运维分析任务
            
            请深入分析以下数据库信息，并提供专业的运维建议。
            
            ## 分析数据
            
            ```json
            {database_data}
            ```
            
            ## 分析要求
            
            1. **性能分析**
               - 识别慢查询，分析执行时间和频率
               - 评估索引使用情况，找出缺失或冗余的索引
               - 分析连接池状态和连接数
               - 评估锁等待情况
            
            2. **配置审计**
               - 检查配置参数是否合理
               - 识别安全配置问题
               - 评估性能相关配置
               - 提供配置优化建议
            
            3. **容量规划**
               - 分析存储空间使用情况
               - 评估数据增长趋势
               - 提供扩容建议
            
            4. **安全审计**
               - 检查用户权限配置
               - 识别潜在安全风险
               - 提供安全加固建议
            
            ## 输出格式
            
            请按以下格式输出分析报告：
            
            ### 1. 执行摘要
            - 数据库基本信息
            - 主要发现（3-5条）
            - 紧急程度评估
            
            ### 2. 性能分析
            - 慢查询TOP 10（包含SQL、执行时间、优化建议）
            - 索引优化建议
            - 连接池分析
            - 性能瓶颈识别
            
            ### 3. 配置审计
            - 配置问题列表
            - 配置优化建议
            - 安全配置检查
            
            ### 4. 容量规划
            - 存储使用分析
            - 增长趋势预测
            - 扩容建议
            
            ### 5. 优化建议
            - 立即执行的优化（高优先级）
            - 计划执行的优化（中优先级）
            - 长期优化建议（低优先级）
            
            **分析时间**: {current_time}
    
    sinks:
      - name: "file"
        params:
          output_path: "reports/mysql_performance_{{timestamp}}.md"
